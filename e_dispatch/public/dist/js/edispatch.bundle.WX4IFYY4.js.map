{
  "version": 3,
  "sources": ["../../../../../apps/e_dispatch/e_dispatch/public/js/scanner/index.js"],
  "sourcesContent": ["frappe.provide(\"frappe.ui\");\n\nlet pScanner = null;\nfrappe.ui.CustomScanner = class Scanner {\n\tconstructor(options) {\n\t\tdebugger\n\t\tthis.dialog = null;\n\t\tthis.handler = null;\n\t\tthis.options = options;\n\t\tthis.is_alive = false;\n\n\t\tif (!(\"multiple\" in this.options)) {\n\t\t\tthis.options.multiple = false;\n\t\t}\n\t\tif (options.container) {\n\t\t\tthis.$scan_area = $(options.container);\n\t\t\tthis.scan_area_id = frappe.dom.set_unique_id(this.$scan_area);\n\t\t}\n\t\tif (options.dialog) {\n\t\t\tthis.dialog = this.make_dialog();\n\t\t\tthis.dialog.show();\n\t\t}\n\t}\n\n\tscan() {\n\t\tdocument.getElementById('showScanner').addEventListener('click', async() => {\n\t\t\tif (pScanner)(await pScanner).show();\n\t\t});\n\t}\n\n\tstart_scan() {\n\t\tif (!this.handler) {\n\t\t\tthis.handler = new Html5Qrcode(this.scan_area_id); // eslint-disable-line\n\t\t}\n\t\tthis.handler\n\t\t\t.start(\n\t\t\t\t{ facingMode: \"environment\" },\n\t\t\t\t{ fps: 10, qrbox: 250 },\n\t\t\t\t(decodedText, decodedResult) => {\n\t\t\t\t\tif (this.options.on_scan) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.options.on_scan(decodedResult);\n\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\tconsole.error(error);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(errorMessage) => {\n\t\t\t\t\t// parse error, ignore it.\n\t\t\t\t}\n\t\t\t)\n\t\t\t.catch((err) => {\n\t\t\t\tthis.is_alive = false;\n\t\t\t\tthis.hide_dialog();\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t\tthis.is_alive = true;\n\t}\n\n\tstop_scan() {\n\t\tif (this.handler && this.is_alive) {\n\t\t\tthis.handler.stop().then(() => {\n\t\t\t\tthis.is_alive = false;\n\t\t\t\tthis.$scan_area.empty();\n\t\t\t\tthis.hide_dialog();\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_dialog() {\n\t\tlet dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Scan QRCode\"),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"HTML\",\n\t\t\t\t\tfieldname: \"scan_area\",\n\t\t\t\t},\n\t\t\t],\n\t\t\ton_page_show: () => {\n\t\t\t\tthis.$scan_area = dialog.get_field(\"scan_area\").$wrapper;\n\t\t\t\tthis.$scan_area.append(`\n\n\t\t\t<div id=\"UIElement\" class=\"UIElement\" style=\"height:400px;\">\n\t\t\t\t<span id='lib-load' style='font-size:x-large' hidden>Loading Library...</span><br />\n\t\t\t</div>\n\t\t\t<div style=\"display:none\">\n\t\t\t\t<span style=\"float:left;margin-top:20px;\">All Results:</span><br />\n\t\t\t\t<div id=\"results\"></div>\n\t\t\t</div>\n\n\t\t\t<script src=\"https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.3.1/dist/dbr.js\"></script>\n\t\t\t<script>\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tDynamsoft.DBR.BarcodeReader.license = 'DLS2eyJoYW5kc2hha2VDb2RlIjoiMTAxNTA3MDI4LTEwMTU4NjM1MiIsIm1haW5TZXJ2ZXJVUkwiOiJodHRwczovL21sdHMuZHluYW1zb2Z0LmNvbS8iLCJvcmdhbml6YXRpb25JRCI6IjEwMTUwNzAyOCIsInN0YW5kYnlTZXJ2ZXJVUkwiOiJodHRwczovL3NsdHMuZHluYW1zb2Z0LmNvbS8iLCJjaGVja0NvZGUiOjE5MjcyMTM4ODN9';\n\t\t\t\t}, 2000)\n\n\t\t\t</script>\n\t\t\t<button id=\"scan_qrcode\" class=\"btn btn-primary\">Start Scanner</button>\n\t\t\t<button class=\"btn btn-primary\" style=\"display:none\" id=\"showScanner\" >Show Scanner</button>\n\t\t\t<p style=\"padding-top:15px\"><label>Total Box Scanned : </label> <b id=\"scanned_box\"></b></p>\n\t\t`);\n\t\t\t\tthis.scan_area_id = frappe.dom.set_unique_id(this.$scan_area);\n\t\t\t\tthis.scan();\n\t\t\t},\n\t\t\ton_hide: () => {\n\t\t\t\tthis.stop_scan();\n\t\t\t},\n\t\t});\n\t\treturn dialog;\n\t}\n\n\thide_dialog() {\n\t\tthis.dialog && this.dialog.hide();\n\t}\n\n\tload_lib() {\n\t\treturn frappe.require(\"/assets/frappe/node_modules/html5-qrcode/html5-qrcode.min.js\");\n\t}\n};\n"],
  "mappings": "MAAA,OAAO,QAAQ,WAAW,EAE1B,IAAIA,EAAW,KACf,OAAO,GAAG,cAAgB,KAAc,CACvC,YAAYC,EAAS,CACpB,SACA,KAAK,OAAS,KACd,KAAK,QAAU,KACf,KAAK,QAAUA,EACf,KAAK,SAAW,GAEV,aAAc,KAAK,UACxB,KAAK,QAAQ,SAAW,IAErBA,EAAQ,YACX,KAAK,WAAa,EAAEA,EAAQ,SAAS,EACrC,KAAK,aAAe,OAAO,IAAI,cAAc,KAAK,UAAU,GAEzDA,EAAQ,SACX,KAAK,OAAS,KAAK,YAAY,EAC/B,KAAK,OAAO,KAAK,EAEnB,CAEA,MAAO,CACN,SAAS,eAAe,aAAa,EAAE,iBAAiB,QAAS,SAAW,CACvED,IAAU,MAAMA,GAAU,KAAK,CACpC,CAAC,CACF,CAEA,YAAa,CACP,KAAK,UACT,KAAK,QAAU,IAAI,YAAY,KAAK,YAAY,GAEjD,KAAK,QACH,MACA,CAAE,WAAY,aAAc,EAC5B,CAAE,IAAK,GAAI,MAAO,GAAI,EACtB,CAACE,EAAaC,IAAkB,CAC/B,GAAI,KAAK,QAAQ,QAChB,GAAI,CACH,KAAK,QAAQ,QAAQA,CAAa,CACnC,OAASC,EAAP,CACD,QAAQ,MAAMA,CAAK,CACpB,CAEF,EACCC,GAAiB,CAElB,CACD,EACC,MAAOC,GAAQ,CACf,KAAK,SAAW,GAChB,KAAK,YAAY,EACjB,QAAQ,MAAMA,CAAG,CAClB,CAAC,EACF,KAAK,SAAW,EACjB,CAEA,WAAY,CACP,KAAK,SAAW,KAAK,UACxB,KAAK,QAAQ,KAAK,EAAE,KAAK,IAAM,CAC9B,KAAK,SAAW,GAChB,KAAK,WAAW,MAAM,EACtB,KAAK,YAAY,CAClB,CAAC,CAEH,CAEA,aAAc,CACb,IAAIC,EAAS,IAAI,OAAO,GAAG,OAAO,CACjC,MAAO,GAAG,aAAa,EACvB,OAAQ,CACP,CACC,UAAW,OACX,UAAW,WACZ,CACD,EACA,aAAc,IAAM,CACnB,KAAK,WAAaA,EAAO,UAAU,WAAW,EAAE,SAChD,KAAK,WAAW,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAoBxB,EACC,KAAK,aAAe,OAAO,IAAI,cAAc,KAAK,UAAU,EAC5D,KAAK,KAAK,CACX,EACA,QAAS,IAAM,CACd,KAAK,UAAU,CAChB,CACD,CAAC,EACD,OAAOA,CACR,CAEA,aAAc,CACb,KAAK,QAAU,KAAK,OAAO,KAAK,CACjC,CAEA,UAAW,CACV,OAAO,OAAO,QAAQ,8DAA8D,CACrF,CACD",
  "names": ["pScanner", "options", "decodedText", "decodedResult", "error", "errorMessage", "err", "dialog"]
}
